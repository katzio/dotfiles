# tmux configuration
# Migration from Ghostty splits to tmux

# ============================================================================
# Basic Settings
# ============================================================================

# Change prefix from Ctrl+b to Ctrl+a (more ergonomic)
unbind C-b
set-option -g prefix C-a
bind-key C-a send-prefix

# Terminal settings for Ghostty compatibility
set -g default-terminal "xterm-256color"
set -ga terminal-overrides ",xterm-256color:Tc"

# Enable mouse support (click to switch panes, resize, etc.)
set -g mouse on

# Start windows and panes at 1, not 0
set -g base-index 1
setw -g pane-base-index 1

# Renumber windows when one is closed
set -g renumber-windows on

# Increase scrollback buffer
set -g history-limit 10000

# Reduce escape time (better for vim/nvim)
set -sg escape-time 0

# ============================================================================
# Split Management (mimicking your Ghostty setup)
# ============================================================================

# Split panes (similar to Ghostty's cmd+d and cmd+shift+d)
# Vertical split (right) - use | for visual clarity
unbind %
bind | split-window -h -c "#{pane_current_path}"
bind '\' split-window -h -c "#{pane_current_path}"

# Horizontal split (down) - use - for visual clarity
unbind '"'
bind - split-window -v -c "#{pane_current_path}"

# Note: 'd' is reserved for detach command (Ctrl+a then d)
# Use | and - for splits instead
# bind d split-window -v -c "#{pane_current_path}"
# bind D split-window -h -c "#{pane_current_path}"

# Close pane (similar to cmd+shift+w)
bind w kill-pane

# ============================================================================
# Pane Navigation (vim-style, matching your cmd+shift+hjkl)
# ============================================================================

# Navigate panes with prefix + h,j,k,l (vim-style)
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# ============================================================================
# Pane Resizing (matching your cmd+ctrl+hjkl)
# ============================================================================

# Resize panes with Ctrl+hjkl (after prefix)
bind -r C-h resize-pane -L 5
bind -r C-j resize-pane -D 5
bind -r C-k resize-pane -U 5
bind -r C-l resize-pane -R 5

# Alternative: resize with arrow keys
bind -r Left resize-pane -L 5
bind -r Down resize-pane -D 5
bind -r Up resize-pane -U 5
bind -r Right resize-pane -R 5

# ============================================================================
# Pane Zoom (matching your cmd+shift+z)
# ============================================================================

# Toggle pane zoom
bind z resize-pane -Z

# Popup terminal (floating window) - press Ctrl+a then Space
bind Space display-popup -E -w 80% -h 80%

# ============================================================================
# Session Management
# ============================================================================

# Quick session switching
bind s choose-session
bind S choose-session

# Navigate between sessions (Ctrl+a then [ or ])
bind [ switch-client -p
bind ] switch-client -n

# Navigate between windows (also bound to Cmd+Shift+[ ] in Ghostty)
bind p previous-window
bind n next-window

# Create new session
bind N command-prompt -p "New session name:" "new-session -s '%%'"

# Rename session
bind R command-prompt -I "#S" "rename-session '%%'"

# ============================================================================
# Window Management
# ============================================================================

# Create new window
bind c new-window -c "#{pane_current_path}"
bind t new-window -c "#{pane_current_path}"
bind -n M-t new-window -c "#{pane_current_path}"  # Alt+t creates new window

# Navigate windows
bind -n M-n next-window
bind -n M-p previous-window

# Jump to specific window
bind 1 select-window -t 1
bind 2 select-window -t 2
bind 3 select-window -t 3
bind 4 select-window -t 4
bind 5 select-window -t 5
bind 6 select-window -t 6
bind 7 select-window -t 7
bind 8 select-window -t 8
bind 9 select-window -t 9

# ============================================================================
# Visual Settings - Tokyo Night Theme
# ============================================================================

# Status bar with rounded powerline separators (Tokyo Night colors)
set -g status-position bottom
set -g status-style 'bg=#1a1b26 fg=#c0caf5'
# Left side - session info

set -g status-left '#[fg=#1a1b26,bg=#ff9e64,nobold] 󰆍 #S #[fg=#ff9e64,bg=#1a1b26,nobold]#[fg=#c0caf5,bg=#1a1b26, nobold] #{session_windows}w #[fg=#1a1b26,bg=#1a1b26, nobold]'
set -g status-right '#[fg=#1a1b26,bg=#1a1b26]#[fg=#c0caf5,bg=#1a1b26] CPU: #{cpu_percentage} | RAM: #{ram_percentage} | 󱂬 #(tmux ls | cut -d: -f1 | xargs | sed "s/ / | /g") '
set -g status-right-length 150
set -g status-left-length 60

# Current window with rounded separators
setw -g window-status-current-style 'fg=#1a1b26 bg=#7aa2f7 nobold'
setw -g window-status-current-format '#[fg=#7aa2f7,bg=#1a1b26]#[fg=#1a1b26,bg=#7aa2f7] #W #[fg=#7aa2f7,bg=#1a1b26]'

# Other windows
setw -g window-status-style 'fg=#565f89 bg=#1a1b26'
setw -g window-status-format ' #W |'

# Pane borders (Tokyo Night colors)
set -g pane-border-style 'fg=#1a1b26'
set -g pane-active-border-style 'fg=#7aa2f7'

# ============================================================================
# Useful Shortcuts
# ============================================================================

# Reload config
bind r source-file ~/.tmux.conf \; display "Config reloaded!"

# Clear screen and scrollback
bind C-l send-keys C-l \; clear-history

# Synchronize panes (type in all panes at once)
bind a setw synchronize-panes

# ============================================================================
# Copy mode (vim-style)
# ============================================================================

# Use vim keybindings in copy mode
setw -g mode-keys vi

# Setup 'v' to begin selection as in Vim
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "pbcopy"

# Update default binding of `Enter` to also use copy-pipe
unbind -T copy-mode-vi Enter
bind -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel "pbcopy"

# ============================================================================
# Plugins (TPM - Tmux Plugin Manager)
# ============================================================================

# List of plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'tmux-plugins/tmux-sessionist'
set -g @plugin 'tmux-plugins/tmux-cpu'

# Plugin settings
# tmux-resurrect: restore nvim sessions
set -g @resurrect-strategy-nvim 'session'
# tmux-continuum: auto-save every 15 minutes
set -g @continuum-save-interval '15'
# tmux-continuum: auto-restore on tmux start
set -g @continuum-restore 'on'

# Initialize TPM (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'
